stages:
  - build
  - deploy_staging
  - deploy_production

# 1. Compilar y generar artifacts
build-job:
  stage: build
  script:
    - echo "Compilando mÃ³dulo..."
    - mkdir dist && cp -r prueba_module dist/
  artifacts:
    paths:
      - dist/
  only:
    - main

# 2. Desplegar a staging
deploy-staging:
  stage: deploy_staging
  dependencies:
    - build-job
  environment:
    name: staging
  script:
    - echo "Desplegando en staging..."
    - ssh-keyscan -H "$ODOO_PRUEBAS_HOST" > known_hosts
    - sshpass -p "$ODOO_RRUEBAS_PASSWORD" scp -r -v -o UserKnownHostsFile=known_hosts dist/prueba_module "$ODOO_PRUEBAS_USER@$ODOO_PRUEBAS_HOST:$DEST_PATH"
  only:
    - main
